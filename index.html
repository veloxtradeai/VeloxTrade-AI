<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>VeloxTrade Pro Terminal</title>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;700;800&family=Rajdhani:wght@500;600;700&display=swap" rel="stylesheet">

<style>
    :root { --bg: #050505; --panel: #0e0e0e; --border: #333; --accent: #ffd700; --green: #00ff88; --red: #ff3b3b; }
    body { background-color: var(--bg); color: #e5e5e5; font-family: 'Rajdhani', sans-serif; overflow-x: hidden; }
    
    /* Terminal Effect */
    .terminal-font { font-family: 'JetBrains Mono', monospace; }
    .glass-panel { background: rgba(20, 20, 20, 0.9); border: 1px solid var(--border); backdrop-filter: blur(10px); }
    
    /* Navigation & Tabs */
    .hidden-panel { display: none; }
    .active-panel { display: block; animation: fadeIn 0.3s ease; }
    
    /* Custom Inputs */
    .v-input { background: #000; border: 1px solid #333; color: white; width: 100%; padding: 12px; border-radius: 8px; outline: none; transition: 0.3s; }
    .v-input:focus { border-color: var(--accent); }
    
    /* Buttons */
    .btn-main { background: var(--accent); color: black; font-weight: 800; text-transform: uppercase; padding: 12px; border-radius: 8px; width: 100%; letter-spacing: 1px; }
    .btn-main:active { transform: scale(0.98); }

    /* Scanner Pulse */
    .scanner-active { border: 1px solid var(--accent); box-shadow: 0 0 15px rgba(255, 215, 0, 0.2); }
    
    /* Menus */
    .menu-item { display: flex; justify-content: space-between; align-items: center; padding: 16px; border-bottom: 1px solid #222; cursor: pointer; }
    .menu-item:active { background: #1a1a1a; }
    .menu-sub { font-size: 12px; color: #666; }

    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>

<body class="antialiased">

<div id="view-login" class="fixed inset-0 z-50 bg-black flex flex-col justify-center items-center p-6 bg-[url('https://www.transparenttextures.com/patterns/carbon-fibre.png')]">
    <div class="w-full max-w-sm glass-panel p-8 rounded-2xl border-t-4 border-yellow-500 shadow-2xl">
        <div class="text-center mb-8">
            <i class="fas fa-bolt text-5xl text-yellow-500 mb-2"></i>
            <h1 class="text-3xl font-black tracking-widest text-white">VELOX<span class="text-yellow-500">.AI</span></h1>
            <p class="text-xs text-gray-500 tracking-[0.4em] mt-1">QUANTUM TRADING ENGINE</p>
        </div>
        
        <div class="space-y-4">
            <div>
                <label class="text-xs text-gray-400 font-bold ml-1">TRADER ID</label>
                <input id="login-email" type="text" class="v-input terminal-font" placeholder="VX-USER-ID" value="admin@velox.ai">
            </div>
            <div>
                <label class="text-xs text-gray-400 font-bold ml-1">ACCESS KEY</label>
                <input id="login-pass" type="password" class="v-input terminal-font" placeholder="••••••••" value="123456">
            </div>
            <button onclick="appLogin()" id="btn-login" class="btn-main mt-4 shadow-[0_0_20px_rgba(255,215,0,0.3)]">
                INITIALIZE TERMINAL
            </button>
            <p id="login-msg" class="text-center text-red-500 text-xs h-4 mt-2"></p>
        </div>
    </div>
</div>

<div id="view-app" class="hidden h-screen flex flex-col">
    
    <header class="h-16 bg-[#0a0a0a] border-b border-[#222] flex items-center justify-between px-4 sticky top-0 z-30">
        <div class="flex items-center gap-3">
            <div onclick="toggleMenu()" class="text-gray-300 text-xl cursor-pointer"><i class="fas fa-bars"></i></div>
            <div>
                <h2 class="text-yellow-500 font-bold leading-none tracking-wider">VELOX</h2>
                <div class="flex items-center gap-1">
                    <div id="conn-status" class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></div>
                    <span class="text-[10px] text-gray-400 font-mono">SYSTEM ONLINE</span>
                </div>
            </div>
        </div>
        <div class="text-right">
            <p class="text-[9px] text-gray-500 uppercase">Margin Available</p>
            <p id="user-balance" class="text-lg font-mono font-bold text-white">₹0.00</p>
        </div>
    </header>

    <div class="flex-1 overflow-y-auto pb-24 bg-[#050505] relative">
        
        <div id="tab-home" class="active-panel p-4 space-y-4">
            <div class="grid grid-cols-2 gap-3">
                <div class="glass-panel p-3 rounded-xl border-l-2 border-green-500">
                    <p class="text-[10px] text-gray-400">NIFTY 50</p>
                    <p class="text-lg font-bold text-green-400">21,450.00</p>
                    <p class="text-[10px] text-green-500">+120.50 (0.6%)</p>
                </div>
                <div class="glass-panel p-3 rounded-xl border-l-2 border-red-500">
                    <p class="text-[10px] text-gray-400">BANKNIFTY</p>
                    <p class="text-lg font-bold text-red-400">47,800.00</p>
                    <p class="text-[10px] text-red-500">-80.20 (0.2%)</p>
                </div>
            </div>

            <div class="glass-panel p-6 rounded-xl text-center border border-yellow-500/20">
                <div class="mb-4">
                    <i class="fas fa-radar text-4xl text-yellow-500 mb-2"></i>
                    <h3 class="text-xl font-bold text-white">AI OPPORTUNITY SCANNER</h3>
                    <p class="text-xs text-gray-500">Connecting to: velox-backend.workers.dev</p>
                </div>
                <button onclick="runScanner()" id="btn-scan" class="btn-main relative overflow-hidden">
                    <span class="relative z-10"><i class="fas fa-search"></i> SCAN MARKET (LIVE)</span>
                </button>
            </div>

            <div class="mt-6">
                <h3 class="text-xs font-bold text-gray-500 mb-2 uppercase">Recent Signals</h3>
                <div id="signals-log" class="space-y-2">
                    <div class="p-3 border border-[#222] rounded bg-[#0a0a0a] text-center text-gray-600 text-xs">
                        No recent signals generated.
                    </div>
                </div>
            </div>
        </div>

        <div id="tab-settings" class="hidden-panel p-0 bg-[#050505]">
            <div class="bg-gray-900 p-4 mb-2">
                <h2 class="text-xl font-bold">Settings & Configuration</h2>
                <p class="text-xs text-gray-400">Build v3.2.1 (Production)</p>
            </div>

            <div class="mb-2">
                <div class="px-4 py-2 bg-[#111] text-xs font-bold text-yellow-500">BILLING & PLANS</div>
                <div class="menu-item">
                    <div>Subscription Plan <div class="menu-sub">Pro Trader (Active)</div></div>
                    <i class="fas fa-chevron-right text-gray-600"></i>
                </div>
                <div class="menu-item">
                    <div>Payment Methods <div class="menu-sub">Manage Cards / UPI</div></div>
                    <i class="fas fa-credit-card text-gray-600"></i>
                </div>
                <div class="menu-item">
                    <div>Transaction History <div class="menu-sub">View Invoices</div></div>
                    <i class="fas fa-history text-gray-600"></i>
                </div>
            </div>

            <div class="mb-2">
                <div class="px-4 py-2 bg-[#111] text-xs font-bold text-yellow-500">TRADING ENGINE</div>
                <div class="menu-item">
                    <div>Auto-Trade Mode <div class="menu-sub">Execute orders automatically</div></div>
                    <i class="fas fa-toggle-off text-gray-500 text-xl"></i>
                </div>
                <div class="menu-item">
                    <div>Broker Connection <div class="menu-sub text-red-400">Disconnected</div></div>
                    <button class="px-3 py-1 bg-blue-600 text-[10px] rounded font-bold">LINK</button>
                </div>
                <div class="menu-item">
                    <div>Order Settings <div class="menu-sub">Default Qty, SL buffer</div></div>
                    <i class="fas fa-sliders-h text-gray-600"></i>
                </div>
            </div>

             <div class="mb-2">
                <div class="px-4 py-2 bg-[#111] text-xs font-bold text-yellow-500">APP PREFERENCES</div>
                <div class="menu-item">
                    <div>Display & Theme <div class="menu-sub">Dark / Terminal</div></div>
                    <i class="fas fa-palette text-gray-600"></i>
                </div>
                <div class="menu-item">
                    <div>Sound & Alerts <div class="menu-sub">Voice / Ringtone</div></div>
                    <i class="fas fa-volume-up text-gray-600"></i>
                </div>
                <div class="menu-item">
                    <div>Support & Help <div class="menu-sub">Contact Developer</div></div>
                    <i class="fas fa-headset text-gray-600"></i>
                </div>
            </div>
            
            <div class="p-6">
                <button onclick="appLogout()" class="w-full py-3 border border-red-900 text-red-500 rounded font-bold bg-red-900/10">SECURE LOGOUT</button>
            </div>
        </div>

    </div>

    <nav class="fixed bottom-0 w-full h-16 bg-[#0a0a0a] border-t border-[#222] flex justify-around items-center z-40">
        <button onclick="switchTab('home')" class="nav-btn active flex flex-col items-center text-yellow-500">
            <i class="fas fa-home text-lg"></i>
            <span class="text-[9px] font-bold mt-1">HOME</span>
        </button>
        <button onclick="switchTab('orders')" class="nav-btn flex flex-col items-center text-gray-500">
            <i class="fas fa-list text-lg"></i>
            <span class="text-[9px] font-bold mt-1">ORDERS</span>
        </button>
        <button onclick="switchTab('portfolio')" class="nav-btn flex flex-col items-center text-gray-500">
            <i class="fas fa-briefcase text-lg"></i>
            <span class="text-[9px] font-bold mt-1">PORTFOLIO</span>
        </button>
        <button onclick="switchTab('settings')" class="nav-btn flex flex-col items-center text-gray-500">
            <i class="fas fa-cog text-lg"></i>
            <span class="text-[9px] font-bold mt-1">SETTINGS</span>
        </button>
    </nav>
</div>

<div id="signal-popup" class="fixed inset-0 z-[100] hidden flex items-center justify-center bg-black/90 backdrop-blur-sm p-4">
    <div class="bg-[#111] w-full max-w-sm border-2 border-yellow-500 rounded-xl overflow-hidden shadow-[0_0_40px_rgba(255,215,0,0.2)]">
        <div class="bg-yellow-500 p-3 flex justify-between items-center text-black">
            <div class="font-black text-lg flex items-center gap-2">
                <i class="fas fa-bolt animate-pulse"></i> NEW SIGNAL
            </div>
            <button onclick="closePopup()" class="font-bold text-xl">&times;</button>
        </div>
        
        <div class="p-6 text-center">
            <h2 id="sig-symbol" class="text-3xl font-black text-white mb-1">LOADING...</h2>
            <div id="sig-type" class="inline-block px-3 py-1 bg-gray-800 text-xs font-bold rounded mb-4">WAITING</div>
            
            <div class="grid grid-cols-3 gap-2 mb-6">
                <div class="bg-[#1a1a1a] p-2 rounded border border-[#333]">
                    <div class="text-[9px] text-gray-500 uppercase">Entry</div>
                    <div id="sig-entry" class="text-sm font-bold text-white">--</div>
                </div>
                <div class="bg-[#1a1a1a] p-2 rounded border border-[#333]">
                    <div class="text-[9px] text-gray-500 uppercase">Stoploss</div>
                    <div id="sig-sl" class="text-sm font-bold text-red-500">--</div>
                </div>
                <div class="bg-[#1a1a1a] p-2 rounded border border-[#333]">
                    <div class="text-[9px] text-gray-500 uppercase">Target</div>
                    <div id="sig-tgt" class="text-sm font-bold text-green-500">--</div>
                </div>
            </div>

            <div class="text-left text-xs text-gray-400 mb-6 bg-[#050505] p-3 rounded">
                <p><strong>LOGIC:</strong> <span id="sig-logic">Analyzing...</span></p>
                <p><strong>CONFIDENCE:</strong> <span id="sig-conf" class="text-yellow-500">--</span></p>
            </div>

            <button onclick="executeTrade()" class="w-full py-4 bg-green-600 hover:bg-green-500 text-black font-black uppercase rounded shadow-lg transition">
                EXECUTE ORDER NOW
            </button>
        </div>
    </div>
</div>

<script>
// --- CONFIGURATION ---
const BACKEND_URL = "https://velox-backend.velox-trade-ai.workers.dev"; // Real Backend URL

// --- AUTHENTICATION ---
async function appLogin() {
    const btn = document.getElementById('btn-login');
    const msg = document.getElementById('login-msg');
    const email = document.getElementById('login-email').value;
    const pass = document.getElementById('login-pass').value;

    btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> AUTHENTICATING...';
    msg.innerText = "";

    try {
        // REAL API CALL TO YOUR WORKER
        const response = await fetch(`${BACKEND_URL}/login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email, password: pass })
        });
        
        const data = await response.json();

        if (data.status === "SUCCESS") {
            document.getElementById('view-login').style.display = 'none';
            document.getElementById('view-app').classList.remove('hidden');
            document.getElementById('user-balance').innerText = `₹${data.user.balance.toLocaleString()}`;
        } else {
            msg.innerText = data.message || "Login Failed";
            btn.innerHTML = 'INITIALIZE TERMINAL';
        }
    } catch (error) {
        console.error(error);
        msg.innerText = "Server Connection Error";
        btn.innerHTML = 'RETRY CONNECTION';
    }
}

function appLogout() {
    if(confirm("Terminate Session?")) location.reload();
}

// --- SCANNER LOGIC (CONNECTED TO BACKEND) ---
async function runScanner() {
    const btn = document.getElementById('btn-scan');
    const originalText = btn.innerHTML;
    
    btn.innerHTML = '<i class="fas fa-satellite-dish fa-spin"></i> SCANNING EXCHANGES...';
    btn.classList.add('scanner-active');

    try {
        // CALLING YOUR CLOUDFLARE WORKER
        const response = await fetch(`${BACKEND_URL}/signals`);
        const data = await response.json();

        // Remove loading state
        btn.innerHTML = originalText;
        btn.classList.remove('scanner-active');

        if (data.status === "SIGNAL_FOUND") {
            // Populate Popup with REAL Data from Backend
            document.getElementById('sig-symbol').innerText = data.symbol;
            document.getElementById('sig-type').innerText = data.type + " SIGNAL";
            document.getElementById('sig-type').className = data.type === "BUY" 
                ? "inline-block px-3 py-1 bg-green-500 text-black text-xs font-bold rounded mb-4"
                : "inline-block px-3 py-1 bg-red-500 text-black text-xs font-bold rounded mb-4";
                
            document.getElementById('sig-entry').innerText = data.entry;
            document.getElementById('sig-sl').innerText = data.stoploss;
            document.getElementById('sig-tgt').innerText = data.targets[0];
            document.getElementById('sig-logic').innerText = data.logic.join(", ");
            document.getElementById('sig-conf').innerText = data.confidence;

            // Play Sound
            playAlertSound();
            
            // Show Popup
            document.getElementById('signal-popup').classList.remove('hidden');
        } else if (data.status === "MARKET_CLOSED") {
            alert("MARKET STATUS: CLOSED. Please try between 09:15 and 15:30 IST.");
        } else {
            alert(data.message || "No setup found. Try again.");
        }

    } catch (error) {
        console.error(error);
        btn.innerHTML = originalText;
        alert("Connection to Velox Cloud Failed.");
    }
}

function closePopup() {
    document.getElementById('signal-popup').classList.add('hidden');
}

function executeTrade() {
    alert("ORDER SENT TO BROKER API\nStatus: Pending Execution");
    closePopup();
}

// --- UTILS ---
function switchTab(tabId) {
    document.querySelectorAll('.active-panel').forEach(el => {
        el.classList.remove('active-panel');
        el.classList.add('hidden-panel');
    });
    
    const target = document.getElementById('tab-' + tabId);
    if(target) {
        target.classList.remove('hidden-panel');
        target.classList.add('active-panel');
    }

    // Update Bottom Nav Color
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('text-yellow-500', 'text-gray-500')); // reset
    document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.add('text-gray-500')); // dim all
    
    // Highlight current (Simple logic for demo)
    // In production, match ID to button
    event.currentTarget.classList.remove('text-gray-500');
    event.currentTarget.classList.add('text-yellow-500');
}

function playAlertSound() {
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    const oscillator = audioCtx.createOscillator();
    const gainNode = audioCtx.createGain();
    
    oscillator.connect(gainNode);
    gainNode.connect(audioCtx.destination);
    
    oscillator.type = 'sine';
    oscillator.frequency.setValueAtTime(880, audioCtx.currentTime); // A5
    oscillator.frequency.exponentialRampToValueAtTime(440, audioCtx.currentTime + 0.5);
    
    gainNode.gain.setValueAtTime(0.1, audioCtx.currentTime);
    gainNode.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + 0.5);
    
    oscillator.start();
    oscillator.stop(audioCtx.currentTime + 0.5);
}
</script>
</body>
</html>
